init:
- ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
  
version: 0.0.{build}
pull_requests:
  do_not_increment_build_number: true
configuration: Release
platform: x64
environment:
  LicensePassword:
    secure: 2Yw7rXcgBViSDE/hm5FOI9NTbniOnKavfriaPHQluuPTWTORjcqBkpJIgYhKGmXZ
  LicenseCsSalt:
    secure: J6ahmdIQMmRdvDifxO9Ec30SfqO5rLeW1vrS3XUbfiKJWIbFWLASKEGYUecq1EppIYG0n2LsRsINFcacnp/xjg==
  LicenseHeaderSalt:
    secure: 4KXNBXfiS4NFxMjimBo5hlr4A7g5njwuKf2Egt2dMgRd3yWHym4KdIpBxxRnHGpHQ0EEewQC/4djl78T+hlFBA==
before_build:
- ps: iex ((New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/appveyor/secure-file/master/install.ps1'))
- cmd: appveyor-tools\secure-file -decrypt ./common/cinecoder_license_string.cs.enc -secret "%LicensePassword%" -salt "%LicenseCsSalt%"
- cmd: appveyor-tools\secure-file -decrypt ./common/cinecoder_license_string.h.enc -secret "%LicensePassword%" -salt "%LicenseHeaderSalt%"
- cmd: nuget restore
build:
  project: Cinecoder.Samples.sln
  verbosity: minimal
test_script:
- cmd: nunit3-console _bin\Release.x64\Daniel2.Managed.Tests.dll --result=myresults.xml;format=AppVeyor
- ps: >-
    _bin\Release.x64\Daniel2.Native.Tests.exe --gtest_output=xml:tests.xml

    $wc = New-Object 'System.Net.WebClient'

    $wc.UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path tests.xml))
after_build:
- cmd: >-
    7z a CinecoderSamples-%APPVEYOR_REPO_BRANCH%-%APPVEYOR_BUILD_VERSION%.zip %APPVEYOR_BUILD_FOLDER%\_bin\Release.x64
    
    appveyor PushArtifact CinecoderSamples-%APPVEYOR_REPO_BRANCH%-%APPVEYOR_BUILD_VERSION%.zip

on_finish:
 - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
      